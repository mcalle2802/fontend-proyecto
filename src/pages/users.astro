---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Oracle - Users & Stats">
  <section class="admin-section">
    <h1>Users & Statistics</h1>
    <p>Oversee every soul wandering under your domain.</p>

    <div id="userList" class="user-list">
      <p>Loading data...</p>
    </div>
    
    <div class="back-action">
      <a href="/admin" class="btn">Back to Oracle's Chamber</a>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const role = localStorage.getItem("userRole");
      if (role !== "master") {
        alert("Access denied. Only the Oracle may view this page.");
        window.location.href = "/login";
        return;
      }

      const list = document.getElementById("userList");
      try {
        const res = await fetch("http://localhost:3000/users", {
          headers: {
            "Authorization": `Bearer ${localStorage.getItem("token")}`,
          },
        });

        if (!res.ok) throw new Error("Failed to fetch users");
        const users = await res.json();

        list.innerHTML = users.map(u => `
          <div class="user-card">
            <h3>${u.name}</h3>
            <p><b>Email:</b> ${u.email}</p>
            <p><b>Role:</b> ${u.roles}</p>
            <p><b>Status:</b> ${u.active ? "Active" : "Inactive"}</p>
          </div>
        `).join("");
      } catch (err) {
        console.error(err);
        list.innerHTML = "<p>⚠️ Error loading users.</p>";
      }
    });
  </script>

  <style>
    .admin-section {
      text-align: center;
      color: #ffae42;
      padding: 3rem 1rem;
      font-family: 'Cinzel', serif;
    }

    .user-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .user-card {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid #ffae42;
      border-radius: 10px;
      padding: 1rem;
      transition: transform 0.3s;
    }

    .user-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.3);
    }

    .back-action {
      text-align: center;
      margin-top: 2rem;
    }

    .btn {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid #ffae42;
      padding: 0.8rem 2rem;
      border-radius: 8px;
      text-decoration: none;
      color: #ffae42;
      transition: background 0.3s, transform 0.2s;
      font-family: 'Cinzel', serif;
    }

    .btn:hover {
      background: rgba(255, 165, 0, 0.3);
      transform: scale(1.05);
    }
  </style>
</BaseLayout>
